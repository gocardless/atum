#!/usr/bin/env ruby

require 'optparse'
require 'atum'

options = { headers: {} }

option_parser = OptionParser.new do |opts|
  opts.banner = 'Usage: atum module_name schema_filename url'

  opts.on('-h', '--help', 'Display this screen') do
    puts opts
    exit
  end

  opts.on('-v', '--version', 'Display the version atum is running at') do
    puts Atum::VERSION
    exit
  end

  opts.on('-H', '--header [HEADER]',
          'Include header with all requests') do |header|
    header_key, header_value, _ = header.split(':', 0)
    options[:headers][header_key] = header_value.strip
  end
end

option_parser.parse!

if ARGV.length != 3
  puts option_parser
  exit
end

options = { default_headers: options[:headers] }

module_name, schema_filename, url = ARGV

generator = Atum::Generation::GeneratorService.new(module_name, schema_filename,
                                                   url, options)
generator.generate_files
